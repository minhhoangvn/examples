- name: "Delete httbin test service {{ item }}"
  command:  'kubectl delete -f "{{ playbook_dir }}/../../templates/httpbin.yaml" {{ item }}'
  register: kubectl
  changed_when: false
  loop:
    - foo
    - bar
    - legacy

- name: "Delete sleep test service {{ item }}"
  command:  'kubectl delete -f "{{ playbook_dir }}/../../templates/sleep.yaml" {{ item }}'
  register: kubectl
  changed_when: false
  loop:
    - foo
    - bar
    - legacy

- name: Clean mTLS policy
  command:  kubectl delete -f /vagrant/k8s/templates/mtls-policy.yaml -n istio-system
  register: kubectl
  changed_when: false

- name: "Delete all deployment {{ item }} namespace"
  command: "kubectl delete deployment --all -n {{ item }}"
  register: kubectl
  changed_when: false
  loop:
    - foo
    - bar
    - legacy   

- name: "Delete all secret {{ item }} namespace"
  command: "kubectl delete secret --all -n {{ item }}"
  register: kubectl
  changed_when: false
  loop:
    - foo
    - bar
    - legacy 

- name: "Delete all configmap {{ item }} namespace"
  command: "kubectl delete configmap --all -n {{ item }}"
  register: kubectl
  changed_when: false
  loop:
    - foo
    - bar
    - legacy

- name: "Delete all svc {{ item }} namespace"
  command: "kubectl delete svc --all -n {{ item }}"
  changed_when: false
  loop:
    - foo
    - bar
    - legacy  

- name: "Delete all serviceentries {{ item }} namespace"
  command: " kubectl delete serviceentries --all -n {{ item }}"
  changed_when: false
  loop:
    - foo
    - bar
    - legacy 
    
- name: "Delete {{ item }} namespace"
  command: "kubectl delete namespace {{ item }}"
  changed_when: false
  loop:
    - foo
    - bar
    - legacy
    - istio-system